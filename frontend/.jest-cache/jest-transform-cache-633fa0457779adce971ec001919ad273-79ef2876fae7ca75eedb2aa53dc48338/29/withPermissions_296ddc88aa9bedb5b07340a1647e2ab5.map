{"version":3,"sources":["/Users/pavan/Desktop/Devops-app-dev-cursor/frontend/src/components/rbac/withPermissions.tsx"],"sourcesContent":["/**\n * Higher-Order Component for Route Protection\n *\n * Protects routes based on user permissions and roles\n */\n\nimport { useRouter } from 'next/navigation';\nimport React from 'react';\nimport { useAuth } from '../../contexts/AuthContext';\n\ninterface WithPermissionsOptions {\n  permissions?: string[];\n  roles?: string[];\n  requireAll?: boolean;\n  adminOnly?: boolean;\n  resource?: string;\n  action?: string;\n  organizationId?: string;\n  redirectTo?: string;\n  fallback?: React.ComponentType;\n}\n\n/**\n * HOC to protect components/pages with permission checks\n */\nexport function withPermissions<T extends object>(\n  WrappedComponent: React.ComponentType<T>,\n  options: WithPermissionsOptions = {}\n) {\n  const {\n    permissions = [],\n    roles = [],\n    requireAll = false,\n    adminOnly = false,\n    resource,\n    action,\n    organizationId,\n    redirectTo = '/unauthorized',\n    fallback: FallbackComponent,\n  } = options;\n\n  const ProtectedComponent: React.FC<T> = (props) => {\n    const router = useRouter();\n    const { isAuthenticated, isLoading, hasPermission, hasRole, user } = useAuth();\n\n    // Show loading state\n    if (isLoading) {\n      return (\n        <div className=\"min-h-screen bg-kassow-dark flex items-center justify-center\">\n          <div className=\"flex flex-col items-center\">\n            <svg\n              className=\"animate-spin h-8 w-8 text-kassow-accent mb-4\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n            >\n              <circle\n                className=\"opacity-25\"\n                cx=\"12\"\n                cy=\"12\"\n                r=\"10\"\n                stroke=\"currentColor\"\n                strokeWidth=\"4\"\n              ></circle>\n              <path\n                className=\"opacity-75\"\n                fill=\"currentColor\"\n                d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n              ></path>\n            </svg>\n            <div className=\"text-kassow-light\">Loading...</div>\n          </div>\n        </div>\n      );\n    }\n\n    // Check if user is authenticated\n    if (!isAuthenticated) {\n      React.useEffect(() => {\n        router.push('/auth/login');\n      }, [router]);\n\n      return null; // Will redirect\n    }\n\n    // Check admin requirement\n    if (adminOnly && user?.role !== 'admin') {\n      React.useEffect(() => {\n        router.push(redirectTo);\n      }, [router]);\n\n      if (FallbackComponent) {\n        return <FallbackComponent />;\n      }\n\n      return (\n        <div className=\"min-h-screen flex items-center justify-center bg-kassow-dark\">\n          <div className=\"text-center\">\n            <h2 className=\"text-2xl font-bold text-kassow-light mb-2\">Access Denied</h2>\n            <p className=\"text-slate-400\">Administrator access required.</p>\n          </div>\n        </div>\n      );\n    }\n\n    // Check resource/action permission\n    if (resource && action) {\n      const hasResourceAccess = hasPermission(`${action}:${resource}`, organizationId);\n      if (!hasResourceAccess) {\n        React.useEffect(() => {\n          router.push(redirectTo);\n        }, [router]);\n\n        if (FallbackComponent) {\n          return <FallbackComponent />;\n        }\n\n        return (\n          <div className=\"min-h-screen flex items-center justify-center bg-kassow-dark\">\n            <div className=\"text-center\">\n              <h2 className=\"text-2xl font-bold text-kassow-light mb-2\">Access Denied</h2>\n              <p className=\"text-slate-400\">\n                You don't have permission to {action} {resource}.\n              </p>\n            </div>\n          </div>\n        );\n      }\n    }\n\n    // Check specific permissions\n    if (permissions.length > 0) {\n      const hasRequiredPermissions = requireAll\n        ? permissions.every((permission) => hasPermission(permission, organizationId))\n        : permissions.some((permission) => hasPermission(permission, organizationId));\n\n      if (!hasRequiredPermissions) {\n        React.useEffect(() => {\n          router.push(redirectTo);\n        }, [router]);\n\n        if (FallbackComponent) {\n          return <FallbackComponent />;\n        }\n\n        return (\n          <div className=\"min-h-screen flex items-center justify-center bg-kassow-dark\">\n            <div className=\"text-center\">\n              <h2 className=\"text-2xl font-bold text-kassow-light mb-2\">Access Denied</h2>\n              <p className=\"text-slate-400\">\n                Required permissions: {permissions.join(requireAll ? ' and ' : ' or ')}\n              </p>\n            </div>\n          </div>\n        );\n      }\n    }\n\n    // Check specific roles\n    if (roles.length > 0) {\n      const hasRequiredRoles = requireAll\n        ? roles.every((role) => hasRole(role))\n        : roles.some((role) => hasRole(role));\n\n      if (!hasRequiredRoles) {\n        React.useEffect(() => {\n          router.push(redirectTo);\n        }, [router]);\n\n        if (FallbackComponent) {\n          return <FallbackComponent />;\n        }\n\n        return (\n          <div className=\"min-h-screen flex items-center justify-center bg-kassow-dark\">\n            <div className=\"text-center\">\n              <h2 className=\"text-2xl font-bold text-kassow-light mb-2\">Access Denied</h2>\n              <p className=\"text-slate-400\">\n                Required roles: {roles.join(requireAll ? ' and ' : ' or ')}\n              </p>\n            </div>\n          </div>\n        );\n      }\n    }\n\n    // All checks passed, render the component\n    return <WrappedComponent {...props} />;\n  };\n\n  ProtectedComponent.displayName = `withPermissions(${WrappedComponent.displayName || WrappedComponent.name})`;\n\n  return ProtectedComponent;\n}\n\n// Convenience HOCs for common use cases\nexport const withAuth = <T extends object>(Component: React.ComponentType<T>) =>\n  withPermissions(Component, {});\n\nexport const withAdminAccess = <T extends object>(Component: React.ComponentType<T>) =>\n  withPermissions(Component, { adminOnly: true });\n\nexport const withRoles = <T extends object>(\n  Component: React.ComponentType<T>,\n  roles: string[],\n  requireAll = false\n) => withPermissions(Component, { roles, requireAll });\n\nexport const withPermission = <T extends object>(\n  Component: React.ComponentType<T>,\n  permission: string,\n  organizationId?: string\n) => withPermissions(Component, { permissions: [permission], organizationId });\n\nexport const withResourceAccess = <T extends object>(\n  Component: React.ComponentType<T>,\n  resource: string,\n  action: string,\n  organizationId?: string\n) => withPermissions(Component, { resource, action, organizationId });\n\n// Default unauthorized page component\nexport const UnauthorizedPage: React.FC = () => (\n  <div className=\"min-h-screen flex items-center justify-center bg-kassow-dark\">\n    <div className=\"max-w-md w-full text-center\">\n      <div className=\"bg-kassow-darker/80 backdrop-blur-lg shadow-2xl rounded-xl border border-gray-700/50 p-8\">\n        <div className=\"w-16 h-16 mx-auto mb-4 bg-red-500/20 rounded-full flex items-center justify-center\">\n          <svg\n            className=\"w-8 h-8 text-red-400\"\n            fill=\"none\"\n            stroke=\"currentColor\"\n            viewBox=\"0 0 24 24\"\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              strokeWidth={2}\n              d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\"\n            />\n          </svg>\n        </div>\n        <h1 className=\"text-2xl font-bold text-kassow-light mb-2\">Access Denied</h1>\n        <p className=\"text-slate-400 mb-6\">\n          You don't have permission to access this page. Please contact your administrator if you\n          believe this is an error.\n        </p>\n        <button\n          onClick={() => window.history.back()}\n          className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-kassow-accent hover:bg-kassow-accent-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-kassow-accent focus:ring-offset-kassow-dark transition-colors\"\n        >\n          Go Back\n        </button>\n      </div>\n    </div>\n  </div>\n);\n\nexport default withPermissions;\n"],"names":["UnauthorizedPage","withAdminAccess","withAuth","withPermission","withPermissions","withResourceAccess","withRoles","WrappedComponent","options","permissions","roles","requireAll","adminOnly","resource","action","organizationId","redirectTo","fallback","FallbackComponent","ProtectedComponent","props","router","useRouter","isAuthenticated","isLoading","hasPermission","hasRole","user","useAuth","div","className","svg","fill","viewBox","circle","cx","cy","r","stroke","strokeWidth","path","d","React","useEffect","push","role","h2","p","hasResourceAccess","length","hasRequiredPermissions","every","permission","some","join","hasRequiredRoles","displayName","name","Component","strokeLinecap","strokeLinejoin","h1","button","onClick","window","history","back"],"mappings":"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"}