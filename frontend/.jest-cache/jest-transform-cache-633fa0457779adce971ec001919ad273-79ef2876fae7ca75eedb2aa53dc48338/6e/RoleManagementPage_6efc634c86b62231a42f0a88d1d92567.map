{"version":3,"sources":["/Users/pavan/Desktop/Devops-app-dev-cursor/frontend/src/components/admin/role-management/RoleManagementPage.tsx"],"sourcesContent":["import { ExclamationTriangleIcon, PlusIcon, UserGroupIcon } from '@heroicons/react/24/outline';\nimport { useMutation, useQuery, useQueryClient } from '@tanstack/react-query';\nimport React, { useState } from 'react';\nimport { roleApi } from '../../../services/roleApi';\nimport { Role } from '../../../types/role';\nimport { PermissionGuard } from '../../rbac/PermissionGuard';\nimport { Button } from '../../ui/Button';\nimport { ConfirmationModal } from '../../ui/Modal';\nimport { StatusIndicator } from '../../ui/StatusIndicator';\nimport { Toast } from '../../ui/Toast';\nimport RoleEditorModal from './RoleEditorModal';\nimport RoleTable from './RoleTable';\n\n/**\n * Main page for managing roles and permissions.\n * Enhanced with comprehensive error handling, loading states, and user feedback.\n */\nconst RoleManagementPage: React.FC = () => {\n  const queryClient = useQueryClient();\n  const [selectedRole, setSelectedRole] = useState<Role | null>(null);\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\n  const [roleToDelete, setRoleToDelete] = useState<Role | null>(null);\n  const [toast, setToast] = useState<{\n    message: string;\n    type: 'success' | 'error' | 'warning' | 'info';\n    show: boolean;\n  }>({ message: '', type: 'success', show: false });\n\n  // Fetch roles\n  const {\n    data: roles,\n    isLoading: rolesLoading,\n    error: rolesError,\n    refetch: refetchRoles,\n  } = useQuery({\n    queryKey: ['roles'],\n    queryFn: () => roleApi.getRoles(true), // Include permissions\n    staleTime: 30000, // 30 seconds\n    retry: 3,\n    retryDelay: (attemptIndex) => Math.min(1000 * 2 ** attemptIndex, 30000),\n  });\n\n  // Fetch permissions\n  const { data: permissions, isLoading: permissionsLoading } = useQuery({\n    queryKey: ['permissions'],\n    queryFn: () => roleApi.getPermissions(),\n    staleTime: 60000, // 1 minute\n    retry: 3,\n  });\n\n  // Create role mutation\n  const createRoleMutation = useMutation({\n    mutationFn: (roleData: any) => roleApi.createRole(roleData),\n    onSuccess: (newRole) => {\n      queryClient.invalidateQueries({ queryKey: ['roles'] });\n      setIsModalOpen(false);\n      setSelectedRole(null);\n      showToast('Role created successfully', 'success');\n    },\n    onError: (error: any) => {\n      const message = error.message || 'Failed to create role';\n      showToast(message, 'error');\n    },\n  });\n\n  // Update role mutation\n  const updateRoleMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: any }) => roleApi.updateRole(id, data),\n    onSuccess: (updatedRole) => {\n      queryClient.invalidateQueries({ queryKey: ['roles'] });\n      setIsModalOpen(false);\n      setSelectedRole(null);\n      showToast('Role updated successfully', 'success');\n    },\n    onError: (error: any) => {\n      const message = error.message || 'Failed to update role';\n      showToast(message, 'error');\n    },\n  });\n\n  // Delete role mutation\n  const deleteRoleMutation = useMutation({\n    mutationFn: (roleId: number) => roleApi.deleteRole(roleId),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['roles'] });\n      setShowDeleteModal(false);\n      setRoleToDelete(null);\n      showToast('Role deleted successfully', 'success');\n    },\n    onError: (error: any) => {\n      const message = error.message || 'Failed to delete role';\n      showToast(message, 'error');\n      setShowDeleteModal(false);\n    },\n  });\n\n  const showToast = (message: string, type: 'success' | 'error' | 'warning' | 'info') => {\n    setToast({ message, type, show: true });\n    setTimeout(() => setToast((prev) => ({ ...prev, show: false })), 5000);\n  };\n\n  const handleEditRole = (role: Role) => {\n    setSelectedRole(role);\n    setIsModalOpen(true);\n  };\n\n  const handleCreateRole = () => {\n    setSelectedRole(null);\n    setIsModalOpen(true);\n  };\n\n  const handleDeleteRole = (role: Role) => {\n    setRoleToDelete(role);\n    setShowDeleteModal(true);\n  };\n\n  const handleCloseModal = () => {\n    setIsModalOpen(false);\n    setSelectedRole(null);\n  };\n\n  const handleRoleSubmit = (roleData: any) => {\n    if (selectedRole) {\n      updateRoleMutation.mutate({ id: selectedRole.id, data: roleData });\n    } else {\n      createRoleMutation.mutate(roleData);\n    }\n  };\n\n  const handleConfirmDelete = () => {\n    if (roleToDelete) {\n      deleteRoleMutation.mutate(roleToDelete.id);\n    }\n  };\n\n  const isLoading = rolesLoading || permissionsLoading;\n  const hasError = rolesError;\n\n  // Error state\n  if (hasError) {\n    return (\n      <div className=\"min-h-screen bg-gray-900 p-6\">\n        <div className=\"max-w-7xl mx-auto\">\n          <div className=\"bg-red-900/20 border border-red-600 rounded-lg p-6 text-center\">\n            <ExclamationTriangleIcon className=\"h-12 w-12 text-red-400 mx-auto mb-4\" />\n            <h2 className=\"text-xl font-semibold text-red-400 mb-2\">Error Loading Roles</h2>\n            <p className=\"text-red-300 mb-4\">\n              {rolesError?.message || 'An error occurred while loading roles'}\n            </p>\n            <Button variant=\"outline\" onClick={() => refetchRoles()}>\n              Try Again\n            </Button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <PermissionGuard permission=\"role:read\">\n      <div className=\"min-h-screen bg-gray-900 p-6\">\n        <div className=\"max-w-7xl mx-auto\">\n          {/* Header */}\n          <div className=\"flex justify-between items-center mb-8\">\n            <div>\n              <h1 className=\"text-3xl font-bold text-white flex items-center\">\n                <UserGroupIcon className=\"h-8 w-8 mr-3 text-blue-500\" />\n                Role Management\n              </h1>\n              <p className=\"text-gray-400 mt-2\">\n                Manage roles, permissions, and access control for your organization\n              </p>\n            </div>\n            <PermissionGuard permission=\"role:create\">\n              <Button\n                variant=\"primary\"\n                leftIcon={<PlusIcon className=\"h-5 w-5\" />}\n                onClick={handleCreateRole}\n                disabled={isLoading}\n              >\n                Create Role\n              </Button>\n            </PermissionGuard>\n          </div>\n\n          {/* Stats Cards */}\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\n            <div className=\"bg-gray-800 rounded-lg p-6 border border-gray-700\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-gray-400 text-sm\">Total Roles</p>\n                  <p className=\"text-2xl font-bold text-white\">\n                    {isLoading ? '...' : roles?.length || 0}\n                  </p>\n                </div>\n                <UserGroupIcon className=\"h-8 w-8 text-blue-500\" />\n              </div>\n            </div>\n\n            <div className=\"bg-gray-800 rounded-lg p-6 border border-gray-700\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-gray-400 text-sm\">System Roles</p>\n                  <p className=\"text-2xl font-bold text-white\">\n                    {isLoading ? '...' : roles?.filter((r) => r.is_system_role).length || 0}\n                  </p>\n                </div>\n                <StatusIndicator status=\"info\" />\n              </div>\n            </div>\n\n            <div className=\"bg-gray-800 rounded-lg p-6 border border-gray-700\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-gray-400 text-sm\">Custom Roles</p>\n                  <p className=\"text-2xl font-bold text-white\">\n                    {isLoading ? '...' : roles?.filter((r) => !r.is_system_role).length || 0}\n                  </p>\n                </div>\n                <StatusIndicator status=\"success\" />\n              </div>\n            </div>\n          </div>\n\n          {/* Role Table */}\n          <RoleTable\n            roles={roles || []}\n            permissions={permissions || []}\n            isLoading={isLoading}\n            onEditRole={handleEditRole}\n            onDeleteRole={handleDeleteRole}\n            onCreateRole={handleCreateRole}\n          />\n\n          {/* Role Editor Modal */}\n          <RoleEditorModal\n            isOpen={isModalOpen}\n            onClose={handleCloseModal}\n            role={selectedRole}\n            permissions={permissions || []}\n            onSubmit={handleRoleSubmit}\n            isLoading={createRoleMutation.isPending || updateRoleMutation.isPending}\n          />\n\n          {/* Delete Confirmation Modal */}\n          <ConfirmationModal\n            isOpen={showDeleteModal}\n            onClose={() => setShowDeleteModal(false)}\n            onConfirm={handleConfirmDelete}\n            title=\"Delete Role\"\n            message={`Are you sure you want to delete the role \"${roleToDelete?.display_name}\"? This action cannot be undone and may affect users with this role.`}\n            confirmText=\"Delete\"\n            cancelText=\"Cancel\"\n            variant=\"danger\"\n            isLoading={deleteRoleMutation.isPending}\n          />\n\n          {/* Toast Notifications */}\n          {toast.show && (\n            <Toast\n              message={toast.message}\n              type={toast.type}\n              onClose={() => setToast((prev) => ({ ...prev, show: false }))}\n            />\n          )}\n        </div>\n      </div>\n    </PermissionGuard>\n  );\n};\n\nexport default RoleManagementPage;\n"],"names":["RoleManagementPage","queryClient","useQueryClient","selectedRole","setSelectedRole","useState","isModalOpen","setIsModalOpen","showDeleteModal","setShowDeleteModal","roleToDelete","setRoleToDelete","toast","setToast","message","type","show","data","roles","isLoading","rolesLoading","error","rolesError","refetch","refetchRoles","useQuery","queryKey","queryFn","roleApi","getRoles","staleTime","retry","retryDelay","attemptIndex","Math","min","permissions","permissionsLoading","getPermissions","createRoleMutation","useMutation","mutationFn","roleData","createRole","onSuccess","newRole","invalidateQueries","showToast","onError","updateRoleMutation","id","updateRole","updatedRole","deleteRoleMutation","roleId","deleteRole","setTimeout","prev","handleEditRole","role","handleCreateRole","handleDeleteRole","handleCloseModal","handleRoleSubmit","mutate","handleConfirmDelete","hasError","div","className","ExclamationTriangleIcon","h2","p","Button","variant","onClick","PermissionGuard","permission","h1","UserGroupIcon","leftIcon","PlusIcon","disabled","length","filter","r","is_system_role","StatusIndicator","status","RoleTable","onEditRole","onDeleteRole","onCreateRole","RoleEditorModal","isOpen","onClose","onSubmit","isPending","ConfirmationModal","onConfirm","title","display_name","confirmText","cancelText","Toast"],"mappings":"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"}