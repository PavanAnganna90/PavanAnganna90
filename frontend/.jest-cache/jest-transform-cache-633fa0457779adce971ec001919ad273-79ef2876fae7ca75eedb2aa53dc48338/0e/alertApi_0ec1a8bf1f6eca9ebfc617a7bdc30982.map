{"version":3,"sources":["/Users/pavan/Desktop/Devops-app-dev-cursor/frontend/src/services/alertApi.ts"],"sourcesContent":["/**\n * Alert API Service\n * \n * Service for connecting to the alert management backend endpoints.\n * Provides methods for fetching alerts, performing actions, and managing lifecycle.\n */\n\nimport { \n  Alert,\n  AlertFilter,\n  AlertSortOptions,\n  AlertListResponse,\n  AlertActionRequest,\n  AlertActionResponse,\n  AlertMetrics,\n  AlertSummary,\n  AlertWithLifecycle,\n  LifecycleTransition\n} from '../types/alert';\n\nclass AlertApiService {\n  private baseUrl: string;\n  \n  constructor() {\n    this.baseUrl = process.env.NODE_ENV === 'production' \n      ? '/api/v1/alerts' \n      : 'http://localhost:8000/api/v1/alerts';\n  }\n\n  private getAuthToken(): string | null {\n    return localStorage.getItem('authToken');\n  }\n\n  private async request<T>(endpoint: string, options: RequestInit = {}): Promise<T> {\n    const token = this.getAuthToken();\n    const url = `${this.baseUrl}${endpoint}`;\n    \n    const defaultHeaders: HeadersInit = {\n      'Content-Type': 'application/json',\n    };\n\n    if (token) {\n      defaultHeaders['Authorization'] = `Bearer ${token}`;\n    }\n\n    const config: RequestInit = {\n      ...options,\n      headers: {\n        ...defaultHeaders,\n        ...options.headers,\n      },\n    };\n\n    try {\n      const response = await fetch(url, config);\n      \n      if (response.status === 401) {\n        throw new Error('Authentication required. Please log in again.');\n      }\n      \n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new Error(`HTTP ${response.status}: ${errorText || response.statusText}`);\n      }\n      \n      return await response.json();\n    } catch (error) {\n      console.error(`API request failed: ${url}`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get alerts with filtering, sorting, and pagination\n   */\n  async getAlerts(\n    filter?: AlertFilter,\n    sort?: AlertSortOptions,\n    page: number = 1,\n    perPage: number = 20\n  ): Promise<AlertListResponse> {\n    const queryParams = new URLSearchParams();\n    \n    // Pagination\n    queryParams.append('page', page.toString());\n    queryParams.append('per_page', perPage.toString());\n    \n    // Sorting\n    if (sort) {\n      queryParams.append('sort_by', sort.field);\n      queryParams.append('sort_order', sort.direction);\n    }\n    \n    // Filtering\n    if (filter) {\n      if (filter.severity?.length) {\n        filter.severity.forEach(severity => queryParams.append('severity', severity));\n      }\n      \n      if (filter.status?.length) {\n        filter.status.forEach(status => queryParams.append('status', status));\n      }\n      \n      if (filter.category?.length) {\n        filter.category.forEach(category => queryParams.append('category', category));\n      }\n      \n      if (filter.channel?.length) {\n        filter.channel.forEach(channel => queryParams.append('channel', channel));\n      }\n      \n      if (filter.source?.length) {\n        filter.source.forEach(source => queryParams.append('source', source));\n      }\n      \n      if (filter.project_id) {\n        queryParams.append('project_id', filter.project_id.toString());\n      }\n      \n      if (filter.date_range) {\n        queryParams.append('start_date', filter.date_range.start);\n        queryParams.append('end_date', filter.date_range.end);\n      }\n      \n      if (filter.search) {\n        queryParams.append('search', filter.search);\n      }\n      \n      if (filter.tags?.length) {\n        filter.tags.forEach(tag => queryParams.append('tags', tag));\n      }\n    }\n\n    return this.request<AlertListResponse>(`?${queryParams}`);\n  }\n\n  /**\n   * Get a specific alert by ID\n   */\n  async getAlert(alertId: string): Promise<Alert> {\n    return this.request<Alert>(`/${alertId}`);\n  }\n\n  /**\n   * Get alert with lifecycle information\n   */\n  async getAlertWithLifecycle(alertId: string): Promise<AlertWithLifecycle> {\n    return this.request<AlertWithLifecycle>(`/${alertId}/lifecycle`);\n  }\n\n  /**\n   * Create a new alert\n   */\n  async createAlert(alertData: Partial<Alert>): Promise<Alert> {\n    return this.request<Alert>('', {\n      method: 'POST',\n      body: JSON.stringify(alertData),\n    });\n  }\n\n  /**\n   * Acknowledge an alert\n   */\n  async acknowledgeAlert(alertId: string, userId?: string, comment?: string): Promise<AlertActionResponse> {\n    const actionRequest: AlertActionRequest = {\n      action: 'acknowledge',\n      user_id: userId,\n      comment,\n    };\n\n    return this.request<AlertActionResponse>(`/${alertId}/acknowledge`, {\n      method: 'PUT',\n      body: JSON.stringify(actionRequest),\n    });\n  }\n\n  /**\n   * Resolve an alert\n   */\n  async resolveAlert(alertId: string, userId?: string, comment?: string): Promise<AlertActionResponse> {\n    const actionRequest: AlertActionRequest = {\n      action: 'resolve',\n      user_id: userId,\n      comment,\n    };\n\n    return this.request<AlertActionResponse>(`/${alertId}/resolve`, {\n      method: 'PUT',\n      body: JSON.stringify(actionRequest),\n    });\n  }\n\n  /**\n   * Suppress an alert\n   */\n  async suppressAlert(alertId: string, userId?: string, comment?: string): Promise<AlertActionResponse> {\n    const actionRequest: AlertActionRequest = {\n      action: 'suppress',\n      user_id: userId,\n      comment,\n    };\n\n    return this.request<AlertActionResponse>(`/${alertId}/suppress`, {\n      method: 'PUT',\n      body: JSON.stringify(actionRequest),\n    });\n  }\n\n  /**\n   * Get alert summary statistics\n   */\n  async getAlertSummary(projectId?: number): Promise<AlertSummary> {\n    const queryParams = new URLSearchParams();\n    if (projectId) {\n      queryParams.append('project_id', projectId.toString());\n    }\n\n    return this.request<AlertSummary>(`/summary?${queryParams}`);\n  }\n\n  /**\n   * Get alert metrics and analytics\n   */\n  async getAlertMetrics(\n    projectId?: number,\n    timeRange?: { start: string; end: string }\n  ): Promise<AlertMetrics> {\n    const queryParams = new URLSearchParams();\n    \n    if (projectId) {\n      queryParams.append('project_id', projectId.toString());\n    }\n    \n    if (timeRange) {\n      queryParams.append('start_date', timeRange.start);\n      queryParams.append('end_date', timeRange.end);\n    }\n\n    return this.request<AlertMetrics>(`/metrics?${queryParams}`);\n  }\n\n  /**\n   * Get lifecycle transitions for an alert\n   */\n  async getLifecycleHistory(alertId: string): Promise<LifecycleTransition[]> {\n    return this.request<LifecycleTransition[]>(`/${alertId}/lifecycle/history`);\n  }\n\n  /**\n   * Manual escalation of an alert\n   */\n  async escalateAlert(alertId: string, reason?: string): Promise<AlertActionResponse> {\n    return this.request<AlertActionResponse>(`/${alertId}/escalate`, {\n      method: 'POST',\n      body: JSON.stringify({ reason }),\n    });\n  }\n\n  /**\n   * Bulk actions on multiple alerts\n   */\n  async bulkAction(\n    alertIds: string[],\n    action: 'acknowledge' | 'resolve' | 'suppress',\n    userId?: string,\n    comment?: string\n  ): Promise<{ success: number; failed: number; results: AlertActionResponse[] }> {\n    return this.request<{ success: number; failed: number; results: AlertActionResponse[] }>('/bulk', {\n      method: 'POST',\n      body: JSON.stringify({\n        alert_ids: alertIds,\n        action,\n        user_id: userId,\n        comment,\n      }),\n    });\n  }\n\n  /**\n   * Get available alert sources\n   */\n  async getSources(): Promise<{ sources: string[]; channels: string[]; categories: string[] }> {\n    return this.request<{ sources: string[]; channels: string[]; categories: string[] }>('/sources');\n  }\n\n  /**\n   * Test alert creation (for development/testing)\n   */\n  async createTestAlert(alertType: 'critical' | 'warning' | 'info' = 'info'): Promise<Alert> {\n    return this.request<Alert>('/test', {\n      method: 'POST',\n      body: JSON.stringify({ type: alertType }),\n    });\n  }\n\n  /**\n   * Get real-time alert updates (for WebSocket connection)\n   */\n  getRealtimeEndpoint(): string {\n    const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n    const wsBaseUrl = process.env.NODE_ENV === 'production' \n      ? `${wsProtocol}//${window.location.host}/ws/alerts`\n      : `${wsProtocol}//localhost:8000/ws/alerts`;\n    \n    const token = this.getAuthToken();\n    return token ? `${wsBaseUrl}?token=${token}` : wsBaseUrl;\n  }\n\n  /**\n   * Health check for alert service\n   */\n  async healthCheck(): Promise<{ status: string; version: string; features: string[] }> {\n    return this.request<{ status: string; version: string; features: string[] }>('/health');\n  }\n}\n\n// Create and export singleton instance\nconst alertApiService = new AlertApiService();\nexport default alertApiService; "],"names":["AlertApiService","constructor","baseUrl","process","env","NODE_ENV","getAuthToken","localStorage","getItem","request","endpoint","options","token","url","defaultHeaders","config","headers","response","fetch","status","Error","ok","errorText","text","statusText","json","error","console","getAlerts","filter","sort","page","perPage","queryParams","URLSearchParams","append","toString","field","direction","severity","length","forEach","category","channel","source","project_id","date_range","start","end","search","tags","tag","getAlert","alertId","getAlertWithLifecycle","createAlert","alertData","method","body","JSON","stringify","acknowledgeAlert","userId","comment","actionRequest","action","user_id","resolveAlert","suppressAlert","getAlertSummary","projectId","getAlertMetrics","timeRange","getLifecycleHistory","escalateAlert","reason","bulkAction","alertIds","alert_ids","getSources","createTestAlert","alertType","type","getRealtimeEndpoint","wsProtocol","window","location","protocol","wsBaseUrl","host","healthCheck","alertApiService"],"mappings":"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"}