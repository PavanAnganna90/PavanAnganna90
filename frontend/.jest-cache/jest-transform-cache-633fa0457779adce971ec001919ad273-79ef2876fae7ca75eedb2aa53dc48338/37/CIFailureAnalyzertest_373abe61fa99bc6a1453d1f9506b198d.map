{"version":3,"sources":["/Users/pavan/Desktop/Devops-app-dev-cursor/frontend/src/components/alerts/__tests__/CIFailureAnalyzer.test.tsx"],"sourcesContent":["/**\n * Tests for CIFailureAnalyzer Component\n */\n\nimport React from 'react';\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react';\nimport '@testing-library/jest-dom';\nimport CIFailureAnalyzer from '../CIFailureAnalyzer';\n\n// Mock the UI components\njest.mock('@/components/ui/Card', () => ({\n  Card: ({ children }: any) => <div data-testid=\"card\">{children}</div>,\n  CardContent: ({ children }: any) => <div data-testid=\"card-content\">{children}</div>,\n  CardHeader: ({ children }: any) => <div data-testid=\"card-header\">{children}</div>,\n  CardTitle: ({ children }: any) => <h3 data-testid=\"card-title\">{children}</h3>,\n}));\n\njest.mock('@/components/ui/Button', () => ({\n  Button: ({ children, onClick, ...props }: any) => (\n    <button onClick={onClick} {...props} data-testid=\"button\">\n      {children}\n    </button>\n  ),\n}));\n\njest.mock('@/components/ui/Badge', () => ({\n  Badge: ({ children, className }: any) => (\n    <span className={className} data-testid=\"badge\">\n      {children}\n    </span>\n  ),\n}));\n\njest.mock('@/components/ui/Tabs', () => ({\n  Tabs: ({ children, value, onValueChange }: any) => (\n    <div data-testid=\"tabs\" data-value={value}>\n      {children}\n    </div>\n  ),\n  TabsContent: ({ children, value }: any) => (\n    <div data-testid=\"tabs-content\" data-value={value}>\n      {children}\n    </div>\n  ),\n  TabsList: ({ children }: any) => <div data-testid=\"tabs-list\">{children}</div>,\n  TabsTrigger: ({ children, value, onClick }: any) => (\n    <button data-testid=\"tabs-trigger\" data-value={value} onClick={onClick}>\n      {children}\n    </button>\n  ),\n}));\n\njest.mock('@/components/ui/Modal', () => ({\n  Modal: ({ children, isOpen, onClose, title }: any) =>\n    isOpen ? (\n      <div data-testid=\"modal\">\n        <h2>{title}</h2>\n        <button onClick={onClose} data-testid=\"modal-close\">\n          Close\n        </button>\n        {children}\n      </div>\n    ) : null,\n}));\n\njest.mock('@/components/ui/Toast', () => ({\n  useToast: () => ({\n    showToast: jest.fn(),\n  }),\n}));\n\ndescribe('CIFailureAnalyzer Component', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it('renders loading state initially', () => {\n    render(<CIFailureAnalyzer />);\n    expect(screen.getByTestId('loading-spinner')).toBeInTheDocument();\n  });\n\n  it('renders compact view when compact prop is true', async () => {\n    render(<CIFailureAnalyzer compact={true} />);\n    \n    await waitFor(() => {\n      expect(screen.getByText('CI Failure Summary')).toBeInTheDocument();\n    });\n    \n    // Should show limited failures in compact mode\n    const analyzeButtons = screen.getAllByText('Analyze');\n    expect(analyzeButtons.length).toBeLessThanOrEqual(3);\n  });\n\n  it('renders full view with statistics when compact is false', async () => {\n    render(<CIFailureAnalyzer compact={false} />);\n    \n    await waitFor(() => {\n      expect(screen.getByText('CI Failure Analysis')).toBeInTheDocument();\n    });\n    \n    // Should show statistics cards\n    expect(screen.getByText('Total Failures')).toBeInTheDocument();\n    expect(screen.getByText('Failure Rate')).toBeInTheDocument();\n    expect(screen.getByText('Avg Fix Time')).toBeInTheDocument();\n    expect(screen.getByText('Top Issue')).toBeInTheDocument();\n  });\n\n  it('displays failure information correctly', async () => {\n    render(<CIFailureAnalyzer />);\n    \n    await waitFor(() => {\n      // Should display mock failure data\n      expect(screen.getByText('test-backend')).toBeInTheDocument();\n      expect(screen.getByText('build-frontend')).toBeInTheDocument();\n      expect(screen.getByText('security-scan')).toBeInTheDocument();\n    });\n  });\n\n  it('opens analysis modal when View Details button is clicked', async () => {\n    render(<CIFailureAnalyzer />);\n    \n    await waitFor(() => {\n      const viewDetailsButtons = screen.getAllByText('View Details');\n      fireEvent.click(viewDetailsButtons[0]);\n    });\n    \n    await waitFor(() => {\n      expect(screen.getByTestId('modal')).toBeInTheDocument();\n      expect(screen.getByText(/Failure Analysis:/)).toBeInTheDocument();\n    });\n  });\n\n  it('switches between tabs correctly', async () => {\n    render(<CIFailureAnalyzer />);\n    \n    await waitFor(() => {\n      const trendsTab = screen.getByRole('button', { name: /trends/i });\n      fireEvent.click(trendsTab);\n    });\n    \n    await waitFor(() => {\n      expect(screen.getByText('Common Failure Types')).toBeInTheDocument();\n      expect(screen.getByText('Trending Issues')).toBeInTheDocument();\n    });\n  });\n\n  it('handles time range selection', async () => {\n    render(<CIFailureAnalyzer />);\n    \n    await waitFor(() => {\n      const timeRangeSelect = screen.getByDisplayValue('Last 24 Hours');\n      fireEvent.change(timeRangeSelect, { target: { value: '7d' } });\n    });\n    \n    expect(screen.getByDisplayValue('Last 7 Days')).toBeInTheDocument();\n  });\n\n  it('calls onFixSuggestion when fix is applied', async () => {\n    const mockOnFixSuggestion = jest.fn();\n    render(<CIFailureAnalyzer onFixSuggestion={mockOnFixSuggestion} />);\n    \n    await waitFor(() => {\n      const viewDetailsButtons = screen.getAllByText('View Details');\n      fireEvent.click(viewDetailsButtons[0]);\n    });\n    \n    await waitFor(() => {\n      const applyFixButton = screen.getByText('Apply Fix Suggestion');\n      fireEvent.click(applyFixButton);\n    });\n    \n    expect(mockOnFixSuggestion).toHaveBeenCalledWith(\n      expect.stringContaining('Add null check')\n    );\n  });\n\n  it('displays severity badges with correct styling', async () => {\n    render(<CIFailureAnalyzer />);\n    \n    await waitFor(() => {\n      const badges = screen.getAllByTestId('badge');\n      const severityBadges = badges.filter(badge => \n        badge.textContent?.includes('test') ||\n        badge.textContent?.includes('build') ||\n        badge.textContent?.includes('security')\n      );\n      \n      expect(severityBadges.length).toBeGreaterThan(0);\n    });\n  });\n\n  it('shows external links for logs and pull requests', async () => {\n    render(<CIFailureAnalyzer />);\n    \n    await waitFor(() => {\n      const viewLogsLinks = screen.getAllByText('View Logs');\n      const viewPRLinks = screen.getAllByText('View PR');\n      \n      expect(viewLogsLinks.length).toBeGreaterThan(0);\n      expect(viewPRLinks.length).toBeGreaterThan(0);\n    });\n  });\n\n  it('handles pipeline health tab correctly', async () => {\n    render(<CIFailureAnalyzer />);\n    \n    await waitFor(() => {\n      const healthTab = screen.getByRole('button', { name: /pipeline health/i });\n      fireEvent.click(healthTab);\n    });\n    \n    await waitFor(() => {\n      expect(screen.getByText('Pipeline Health Status')).toBeInTheDocument();\n      expect(screen.getByText('test-backend')).toBeInTheDocument();\n      expect(screen.getByText('build-frontend')).toBeInTheDocument();\n    });\n  });\n\n  it('displays error analysis with confidence levels', async () => {\n    render(<CIFailureAnalyzer />);\n    \n    await waitFor(() => {\n      const viewDetailsButtons = screen.getAllByText('View Details');\n      fireEvent.click(viewDetailsButtons[0]);\n    });\n    \n    await waitFor(() => {\n      expect(screen.getByText('AI Analysis')).toBeInTheDocument();\n      expect(screen.getByText(/85% confidence/)).toBeInTheDocument();\n      expect(screen.getByText(/Null Pointer Exception/)).toBeInTheDocument();\n    });\n  });\n});"],"names":["jest","mock","Card","children","div","data-testid","CardContent","CardHeader","CardTitle","h3","Button","onClick","props","button","Badge","className","span","Tabs","value","onValueChange","data-value","TabsContent","TabsList","TabsTrigger","Modal","isOpen","onClose","title","h2","useToast","showToast","fn","describe","beforeEach","clearAllMocks","it","render","CIFailureAnalyzer","expect","screen","getByTestId","toBeInTheDocument","compact","waitFor","getByText","analyzeButtons","getAllByText","length","toBeLessThanOrEqual","viewDetailsButtons","fireEvent","click","trendsTab","getByRole","name","timeRangeSelect","getByDisplayValue","change","target","mockOnFixSuggestion","onFixSuggestion","applyFixButton","toHaveBeenCalledWith","stringContaining","badges","getAllByTestId","severityBadges","filter","badge","textContent","includes","toBeGreaterThan","viewLogsLinks","viewPRLinks","healthTab"],"mappings":"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"}