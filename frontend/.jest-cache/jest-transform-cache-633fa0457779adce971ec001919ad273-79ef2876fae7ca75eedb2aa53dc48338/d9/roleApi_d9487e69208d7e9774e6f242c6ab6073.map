{"version":3,"sources":["/Users/pavan/Desktop/Devops-app-dev-cursor/frontend/src/services/roleApi.ts"],"sourcesContent":["/**\n * Role API Service\n * \n * Service for connecting to role and permission management backend endpoints.\n * Provides methods for role CRUD operations, permission management, and user assignments.\n */\n\nimport {\n  Role,\n  RoleCreate,\n  RoleUpdate,\n  Permission,\n  PermissionType,\n  PermissionCategory,\n  UserRoleAssignmentRequest,\n  UserRoleAssignmentResponse,\n  RolePermissionsResponse,\n  UserPermissions,\n  RoleAnalytics,\n  PermissionMatrix,\n  RoleComparison,\n  BulkRoleOperation,\n  BulkRoleOperationResponse,\n  RoleSuggestion,\n  RBACHealth\n} from '../types/role';\n\nclass RoleApiService {\n  private baseUrl: string;\n  \n  constructor() {\n    this.baseUrl = process.env.NODE_ENV === 'production' \n      ? '/api/v1/roles' \n      : 'http://localhost:8000/api/v1/roles';\n  }\n\n  private getAuthToken(): string | null {\n    return localStorage.getItem('authToken');\n  }\n\n  private async request<T>(endpoint: string, options: RequestInit = {}): Promise<T> {\n    const token = this.getAuthToken();\n    const url = `${this.baseUrl}${endpoint}`;\n    \n    const defaultHeaders: HeadersInit = {\n      'Content-Type': 'application/json',\n    };\n\n    if (token) {\n      defaultHeaders['Authorization'] = `Bearer ${token}`;\n    }\n\n    const config: RequestInit = {\n      ...options,\n      headers: {\n        ...defaultHeaders,\n        ...options.headers,\n      },\n    };\n\n    try {\n      const response = await fetch(url, config);\n      \n      if (response.status === 401) {\n        throw new Error('Authentication required. Please log in again.');\n      }\n      \n      if (response.status === 403) {\n        throw new Error('Access denied. You do not have permission to perform this action.');\n      }\n      \n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new Error(`HTTP ${response.status}: ${errorText || response.statusText}`);\n      }\n      \n      return await response.json();\n    } catch (error) {\n      console.error(`Role API request failed: ${url}`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get all roles\n   */\n  async getRoles(includePermissions: boolean = false): Promise<Role[]> {\n    const queryParams = includePermissions ? '?include_permissions=true' : '';\n    return this.request<Role[]>(`${queryParams}`);\n  }\n\n  /**\n   * Get a specific role by ID\n   */\n  async getRole(roleId: number): Promise<Role> {\n    return this.request<Role>(`/${roleId}`);\n  }\n\n  /**\n   * Create a new role\n   */\n  async createRole(roleData: RoleCreate): Promise<Role> {\n    return this.request<Role>('', {\n      method: 'POST',\n      body: JSON.stringify(roleData),\n    });\n  }\n\n  /**\n   * Update an existing role\n   */\n  async updateRole(roleId: number, roleData: RoleUpdate): Promise<Role> {\n    return this.request<Role>(`/${roleId}`, {\n      method: 'PUT',\n      body: JSON.stringify(roleData),\n    });\n  }\n\n  /**\n   * Delete a role\n   */\n  async deleteRole(roleId: number): Promise<{ message: string }> {\n    return this.request<{ message: string }>(`/${roleId}`, {\n      method: 'DELETE',\n    });\n  }\n\n  /**\n   * Get all permissions\n   */\n  async getPermissions(): Promise<Permission[]> {\n    return this.request<Permission[]>('/permissions');\n  }\n\n  /**\n   * Get permissions organized by category\n   */\n  async getPermissionCategories(): Promise<PermissionCategory[]> {\n    return this.request<PermissionCategory[]>('/permissions/categories');\n  }\n\n  /**\n   * Get role permissions\n   */\n  async getRolePermissions(roleId: number): Promise<RolePermissionsResponse> {\n    return this.request<RolePermissionsResponse>(`/${roleId}/permissions`);\n  }\n\n  /**\n   * Update role permissions\n   */\n  async updateRolePermissions(\n    roleId: number,\n    permissionIds: number[]\n  ): Promise<RolePermissionsResponse> {\n    return this.request<RolePermissionsResponse>(`/${roleId}/permissions`, {\n      method: 'PUT',\n      body: JSON.stringify({ permission_ids: permissionIds }),\n    });\n  }\n\n  /**\n   * Assign role to user\n   */\n  async assignRoleToUser(assignmentData: UserRoleAssignmentRequest): Promise<UserRoleAssignmentResponse> {\n    return this.request<UserRoleAssignmentResponse>('/assign', {\n      method: 'POST',\n      body: JSON.stringify(assignmentData),\n    });\n  }\n\n  /**\n   * Remove role from user\n   */\n  async removeRoleFromUser(userId: number, roleId: number): Promise<{ message: string }> {\n    return this.request<{ message: string }>(`/unassign`, {\n      method: 'POST',\n      body: JSON.stringify({ user_id: userId, role_id: roleId }),\n    });\n  }\n\n  /**\n   * Get user's effective permissions\n   */\n  async getUserPermissions(userId: number): Promise<UserPermissions> {\n    return this.request<UserPermissions>(`/users/${userId}/permissions`);\n  }\n\n  /**\n   * Get current user's permissions\n   */\n  async getCurrentUserPermissions(): Promise<UserPermissions> {\n    return this.request<UserPermissions>('/users/me/permissions');\n  }\n\n  /**\n   * Check if user has specific permission\n   */\n  async checkUserPermission(\n    userId: number,\n    permission: PermissionType,\n    teamId?: number\n  ): Promise<{ allowed: boolean; reason?: string }> {\n    const queryParams = new URLSearchParams({\n      permission,\n      ...(teamId && { team_id: teamId.toString() }),\n    });\n\n    return this.request<{ allowed: boolean; reason?: string }>(\n      `/users/${userId}/check-permission?${queryParams}`\n    );\n  }\n\n  /**\n   * Get role analytics\n   */\n  async getRoleAnalytics(): Promise<RoleAnalytics> {\n    return this.request<RoleAnalytics>('/analytics');\n  }\n\n  /**\n   * Get permission matrix for all roles\n   */\n  async getPermissionMatrix(): Promise<PermissionMatrix> {\n    return this.request<PermissionMatrix>('/matrix');\n  }\n\n  /**\n   * Compare two roles\n   */\n  async compareRoles(role1Id: number, role2Id: number): Promise<RoleComparison> {\n    return this.request<RoleComparison>(`/compare/${role1Id}/${role2Id}`);\n  }\n\n  /**\n   * Bulk role operations\n   */\n  async bulkRoleOperation(operation: BulkRoleOperation): Promise<BulkRoleOperationResponse> {\n    return this.request<BulkRoleOperationResponse>('/bulk', {\n      method: 'POST',\n      body: JSON.stringify(operation),\n    });\n  }\n\n  /**\n   * Get role suggestions for users\n   */\n  async getRoleSuggestions(): Promise<RoleSuggestion[]> {\n    return this.request<RoleSuggestion[]>('/suggestions');\n  }\n\n  /**\n   * Get RBAC health check\n   */\n  async getRBACHealth(): Promise<RBACHealth> {\n    return this.request<RBACHealth>('/health');\n  }\n\n  /**\n   * Get users with specific role\n   */\n  async getUsersWithRole(roleId: number): Promise<{\n    users: {\n      id: number;\n      github_username: string;\n      email: string;\n      full_name: string | null;\n      avatar_url: string | null;\n      assigned_at: string;\n      assigned_by_user_id: number | null;\n    }[];\n    total: number;\n  }> {\n    return this.request<{\n      users: {\n        id: number;\n        github_username: string;\n        email: string;\n        full_name: string | null;\n        avatar_url: string | null;\n        assigned_at: string;\n        assigned_by_user_id: number | null;\n      }[];\n      total: number;\n    }>(`/${roleId}/users`);\n  }\n\n  /**\n   * Clone a role\n   */\n  async cloneRole(roleId: number, newName: string): Promise<Role> {\n    return this.request<Role>(`/${roleId}/clone`, {\n      method: 'POST',\n      body: JSON.stringify({ name: newName }),\n    });\n  }\n\n  /**\n   * Get role hierarchy\n   */\n  async getRoleHierarchy(): Promise<{\n    roles: Role[];\n    hierarchy: {\n      [roleId: number]: {\n        parent_roles: number[];\n        child_roles: number[];\n        level: number;\n      };\n    };\n  }> {\n    return this.request<{\n      roles: Role[];\n      hierarchy: {\n        [roleId: number]: {\n          parent_roles: number[];\n          child_roles: number[];\n          level: number;\n        };\n      };\n    }>('/hierarchy');\n  }\n\n  /**\n   * Export roles configuration\n   */\n  async exportRoles(): Promise<{\n    roles: Role[];\n    permissions: Permission[];\n    assignments: {\n      user_id: number;\n      role_ids: number[];\n    }[];\n    export_date: string;\n  }> {\n    return this.request<{\n      roles: Role[];\n      permissions: Permission[];\n      assignments: {\n        user_id: number;\n        role_ids: number[];\n      }[];\n      export_date: string;\n    }>('/export');\n  }\n\n  /**\n   * Import roles configuration\n   */\n  async importRoles(configData: {\n    roles: Partial<Role>[];\n    overwrite_existing: boolean;\n  }): Promise<{\n    imported_roles: number;\n    skipped_roles: number;\n    errors: string[];\n  }> {\n    return this.request<{\n      imported_roles: number;\n      skipped_roles: number;\n      errors: string[];\n    }>('/import', {\n      method: 'POST',\n      body: JSON.stringify(configData),\n    });\n  }\n\n  /**\n   * Validate role configuration\n   */\n  async validateRoleConfig(): Promise<{\n    valid: boolean;\n    issues: {\n      type: 'warning' | 'error';\n      message: string;\n      affected_roles: number[];\n    }[];\n    recommendations: string[];\n  }> {\n    return this.request<{\n      valid: boolean;\n      issues: {\n        type: 'warning' | 'error';\n        message: string;\n        affected_roles: number[];\n      }[];\n      recommendations: string[];\n    }>('/validate');\n  }\n}\n\n// Export singleton instance\nexport const roleApi = new RoleApiService();\nexport default roleApi; "],"names":["roleApi","RoleApiService","constructor","baseUrl","process","env","NODE_ENV","getAuthToken","localStorage","getItem","request","endpoint","options","token","url","defaultHeaders","config","headers","response","fetch","status","Error","ok","errorText","text","statusText","json","error","console","getRoles","includePermissions","queryParams","getRole","roleId","createRole","roleData","method","body","JSON","stringify","updateRole","deleteRole","getPermissions","getPermissionCategories","getRolePermissions","updateRolePermissions","permissionIds","permission_ids","assignRoleToUser","assignmentData","removeRoleFromUser","userId","user_id","role_id","getUserPermissions","getCurrentUserPermissions","checkUserPermission","permission","teamId","URLSearchParams","team_id","toString","getRoleAnalytics","getPermissionMatrix","compareRoles","role1Id","role2Id","bulkRoleOperation","operation","getRoleSuggestions","getRBACHealth","getUsersWithRole","cloneRole","newName","name","getRoleHierarchy","exportRoles","importRoles","configData","validateRoleConfig"],"mappings":"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"}