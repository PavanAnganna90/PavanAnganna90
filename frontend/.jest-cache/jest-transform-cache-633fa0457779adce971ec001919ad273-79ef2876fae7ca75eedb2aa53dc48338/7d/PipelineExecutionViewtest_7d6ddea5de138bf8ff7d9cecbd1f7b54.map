{"version":3,"sources":["/Users/pavan/Desktop/Devops-app-dev-cursor/frontend/src/components/dashboard/__tests__/PipelineExecutionView.test.tsx"],"sourcesContent":["import React from 'react';\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react';\nimport '@testing-library/jest-dom';\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\nimport { PipelineExecutionView } from '../PipelineExecutionView';\n\n// Mock Socket.IO\njest.mock('socket.io-client', () => ({\n  io: jest.fn(() => ({\n    on: jest.fn(),\n    off: jest.fn(),\n    emit: jest.fn(),\n    disconnect: jest.fn(),\n  })),\n}));\n\n// Mock date-fns\njest.mock('date-fns', () => ({\n  format: jest.fn((date) => date.toISOString()),\n  formatDistanceToNow: jest.fn(() => '2 hours ago'),\n}));\n\n// Mock fetch\nglobal.fetch = jest.fn();\n\n// Mock pipelines data\nconst mockPipelines = [\n  {\n    id: 1,\n    name: 'Frontend CI/CD',\n    repository_url: 'https://github.com/org/frontend',\n    branch: 'main',\n    is_active: true,\n  },\n  {\n    id: 2,\n    name: 'Backend API',\n    repository_url: 'https://github.com/org/backend',\n    branch: 'main',\n    is_active: true,\n  },\n];\n\n// Mock pipeline runs data\nconst mockPipelineRuns = [\n  {\n    id: 1,\n    pipeline_id: 1,\n    run_number: 42,\n    status: 'running' as const,\n    commit_sha: 'abc123',\n    commit_message: 'feat: add new feature',\n    triggered_by: 'john.doe',\n    trigger_event: 'push' as const,\n    started_at: new Date().toISOString(),\n    branch: 'main',\n    steps: [\n      {\n        id: 1,\n        name: 'Build',\n        status: 'success' as const,\n        started_at: new Date().toISOString(),\n        finished_at: new Date().toISOString(),\n        duration_seconds: 120,\n      },\n      {\n        id: 2,\n        name: 'Test',\n        status: 'running' as const,\n        started_at: new Date().toISOString(),\n      },\n      {\n        id: 3,\n        name: 'Deploy',\n        status: 'pending' as const,\n      },\n    ],\n    logs: ['Starting build...', 'Building project...', 'Build complete'],\n  },\n  {\n    id: 2,\n    pipeline_id: 2,\n    run_number: 15,\n    status: 'success' as const,\n    commit_sha: 'def456',\n    commit_message: 'fix: bug fix',\n    triggered_by: 'jane.smith',\n    trigger_event: 'pull_request' as const,\n    started_at: new Date(Date.now() - 3600000).toISOString(),\n    finished_at: new Date().toISOString(),\n    duration_seconds: 300,\n    branch: 'feature/fix',\n  },\n];\n\n// Helper function to create a wrapper with QueryClient\nconst createWrapper = () => {\n  const queryClient = new QueryClient({\n    defaultOptions: {\n      queries: {\n        retry: false,\n      },\n    },\n  });\n  \n  return ({ children }: { children: React.ReactNode }) => (\n    <QueryClientProvider client={queryClient}>\n      {children}\n    </QueryClientProvider>\n  );\n};\n\ndescribe('PipelineExecutionView', () => {\n  beforeEach(() => {\n    (fetch as jest.Mock).mockClear();\n    \n    // Setup default fetch responses\n    (fetch as jest.Mock)\n      .mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockPipelines,\n      })\n      .mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockPipelineRuns,\n      });\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it('renders the component with header and loading state initially', async () => {\n    const Wrapper = createWrapper();\n    \n    render(\n      <Wrapper>\n        <PipelineExecutionView />\n      </Wrapper>\n    );\n\n    // Check for header\n    expect(screen.getByText('Pipeline Execution')).toBeInTheDocument();\n    expect(screen.getByText('Real-time view of pipeline executions')).toBeInTheDocument();\n\n    // Check for loading state\n    expect(screen.getByText('Loading pipeline executions...')).toBeInTheDocument();\n  });\n\n  it('displays pipeline runs after loading', async () => {\n    const Wrapper = createWrapper();\n    \n    render(\n      <Wrapper>\n        <PipelineExecutionView />\n      </Wrapper>\n    );\n\n    // Wait for data to load\n    await waitFor(() => {\n      expect(screen.getByText('Frontend CI/CD #42')).toBeInTheDocument();\n    });\n\n    // Check pipeline run details\n    expect(screen.getByText('feat: add new feature')).toBeInTheDocument();\n    expect(screen.getByText('john.doe')).toBeInTheDocument();\n    expect(screen.getByText('main')).toBeInTheDocument();\n    expect(screen.getByText('Running')).toBeInTheDocument();\n\n    // Check second pipeline run\n    expect(screen.getByText('Backend API #15')).toBeInTheDocument();\n    expect(screen.getByText('fix: bug fix')).toBeInTheDocument();\n    expect(screen.getByText('jane.smith')).toBeInTheDocument();\n    expect(screen.getByText('Success')).toBeInTheDocument();\n  });\n\n  it('shows empty state when no pipeline runs are found', async () => {\n    const Wrapper = createWrapper();\n    \n    // Mock empty response\n    (fetch as jest.Mock)\n      .mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockPipelines,\n      })\n      .mockResolvedValueOnce({\n        ok: true,\n        json: async () => [],\n      });\n    \n    render(\n      <Wrapper>\n        <PipelineExecutionView />\n      </Wrapper>\n    );\n\n    await waitFor(() => {\n      expect(screen.getByText('No pipeline executions')).toBeInTheDocument();\n      expect(screen.getByText('No recent pipeline executions found.')).toBeInTheDocument();\n    });\n  });\n\n  it('shows error state when fetch fails', async () => {\n    const Wrapper = createWrapper();\n    \n    // Mock fetch error\n    (fetch as jest.Mock)\n      .mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockPipelines,\n      })\n      .mockRejectedValueOnce(new Error('Network error'));\n    \n    render(\n      <Wrapper>\n        <PipelineExecutionView />\n      </Wrapper>\n    );\n\n    await waitFor(() => {\n      expect(screen.getByText('Error loading pipeline data')).toBeInTheDocument();\n    });\n  });\n\n  it('applies custom className', () => {\n    const Wrapper = createWrapper();\n    \n    render(\n      <Wrapper>\n        <PipelineExecutionView className=\"custom-class\" />\n      </Wrapper>\n    );\n\n    const container = screen.getByText('Pipeline Execution').closest('div');\n    expect(container).toHaveClass('custom-class');\n  });\n});\n\n// Test the StatusBadge component separately\ndescribe('StatusBadge Component', () => {\n  const StatusBadge: React.FC<{ status: string; size?: 'sm' | 'md' }> = ({ \n    status, \n    size = 'md' \n  }) => {\n    const statusConfig = {\n      pending: { label: 'Pending' },\n      running: { label: 'Running' },\n      success: { label: 'Success' },\n      failure: { label: 'Failed' },\n      cancelled: { label: 'Cancelled' },\n      skipped: { label: 'Skipped' },\n    };\n\n    const config = statusConfig[status as keyof typeof statusConfig] || statusConfig.pending;\n    const sizeClasses = size === 'sm' ? 'text-xs px-2 py-1' : 'text-sm px-3 py-1.5';\n\n    return (\n      <span className={`inline-flex items-center gap-1.5 rounded-full font-medium ${sizeClasses}`}>\n        {config.label}\n      </span>\n    );\n  };\n\n  it('renders all status types correctly', () => {\n    const statuses = ['pending', 'running', 'success', 'failure', 'cancelled', 'skipped'];\n    \n    statuses.forEach(status => {\n      const { unmount } = render(<StatusBadge status={status} />);\n      const expectedLabel = status === 'failure' ? 'Failed' : \n                           status.charAt(0).toUpperCase() + status.slice(1);\n      expect(screen.getByText(expectedLabel)).toBeInTheDocument();\n      unmount();\n    });\n  });\n\n  it('applies correct size classes', () => {\n    const { rerender } = render(<StatusBadge status=\"success\" size=\"sm\" />);\n    expect(screen.getByText('Success')).toHaveClass('text-xs', 'px-2', 'py-1');\n    \n    rerender(<StatusBadge status=\"success\" size=\"md\" />);\n    expect(screen.getByText('Success')).toHaveClass('text-sm', 'px-3', 'py-1.5');\n  });\n}); "],"names":["jest","mock","io","fn","on","off","emit","disconnect","format","date","toISOString","formatDistanceToNow","global","fetch","mockPipelines","id","name","repository_url","branch","is_active","mockPipelineRuns","pipeline_id","run_number","status","commit_sha","commit_message","triggered_by","trigger_event","started_at","Date","steps","finished_at","duration_seconds","logs","now","createWrapper","queryClient","QueryClient","defaultOptions","queries","retry","children","QueryClientProvider","client","describe","beforeEach","mockClear","mockResolvedValueOnce","ok","json","afterEach","clearAllMocks","it","Wrapper","render","PipelineExecutionView","expect","screen","getByText","toBeInTheDocument","waitFor","mockRejectedValueOnce","Error","className","container","closest","toHaveClass","StatusBadge","size","statusConfig","pending","label","running","success","failure","cancelled","skipped","config","sizeClasses","span","statuses","forEach","unmount","expectedLabel","charAt","toUpperCase","slice","rerender"],"mappings":";AAMA,iBAAiB;AACjBA,KAAKC,IAAI,CAAC,oBAAoB,IAAO,CAAA;QACnCC,IAAIF,KAAKG,EAAE,CAAC,IAAO,CAAA;gBACjBC,IAAIJ,KAAKG,EAAE;gBACXE,KAAKL,KAAKG,EAAE;gBACZG,MAAMN,KAAKG,EAAE;gBACbI,YAAYP,KAAKG,EAAE;YACrB,CAAA;IACF,CAAA;AAEA,gBAAgB;AAChBH,KAAKC,IAAI,CAAC,YAAY,IAAO,CAAA;QAC3BO,QAAQR,KAAKG,EAAE,CAAC,CAACM,OAASA,KAAKC,WAAW;QAC1CC,qBAAqBX,KAAKG,EAAE,CAAC,IAAM;IACrC,CAAA;;;;;8DApBkB;wBACiC;QAC5C;4BAC0C;uCACX;;;;;;AAkBtC,aAAa;AACbS,OAAOC,KAAK,GAAGb,KAAKG,EAAE;AAEtB,sBAAsB;AACtB,MAAMW,gBAAgB;IACpB;QACEC,IAAI;QACJC,MAAM;QACNC,gBAAgB;QAChBC,QAAQ;QACRC,WAAW;IACb;IACA;QACEJ,IAAI;QACJC,MAAM;QACNC,gBAAgB;QAChBC,QAAQ;QACRC,WAAW;IACb;CACD;AAED,0BAA0B;AAC1B,MAAMC,mBAAmB;IACvB;QACEL,IAAI;QACJM,aAAa;QACbC,YAAY;QACZC,QAAQ;QACRC,YAAY;QACZC,gBAAgB;QAChBC,cAAc;QACdC,eAAe;QACfC,YAAY,IAAIC,OAAOnB,WAAW;QAClCQ,QAAQ;QACRY,OAAO;YACL;gBACEf,IAAI;gBACJC,MAAM;gBACNO,QAAQ;gBACRK,YAAY,IAAIC,OAAOnB,WAAW;gBAClCqB,aAAa,IAAIF,OAAOnB,WAAW;gBACnCsB,kBAAkB;YACpB;YACA;gBACEjB,IAAI;gBACJC,MAAM;gBACNO,QAAQ;gBACRK,YAAY,IAAIC,OAAOnB,WAAW;YACpC;YACA;gBACEK,IAAI;gBACJC,MAAM;gBACNO,QAAQ;YACV;SACD;QACDU,MAAM;YAAC;YAAqB;YAAuB;SAAiB;IACtE;IACA;QACElB,IAAI;QACJM,aAAa;QACbC,YAAY;QACZC,QAAQ;QACRC,YAAY;QACZC,gBAAgB;QAChBC,cAAc;QACdC,eAAe;QACfC,YAAY,IAAIC,KAAKA,KAAKK,GAAG,KAAK,SAASxB,WAAW;QACtDqB,aAAa,IAAIF,OAAOnB,WAAW;QACnCsB,kBAAkB;QAClBd,QAAQ;IACV;CACD;AAED,uDAAuD;AACvD,MAAMiB,gBAAgB;IACpB,MAAMC,cAAc,IAAIC,uBAAW,CAAC;QAClCC,gBAAgB;YACdC,SAAS;gBACPC,OAAO;YACT;QACF;IACF;IAEA,OAAO,CAAC,EAAEC,QAAQ,EAAiC,iBACjD,qBAACC,+BAAmB;YAACC,QAAQP;sBAC1BK;;AAGP;AAEAG,SAAS,yBAAyB;IAChCC,WAAW;QACRhC,MAAoBiC,SAAS;QAE9B,gCAAgC;QAC/BjC,MACEkC,qBAAqB,CAAC;YACrBC,IAAI;YACJC,MAAM,UAAYnC;QACpB,GACCiC,qBAAqB,CAAC;YACrBC,IAAI;YACJC,MAAM,UAAY7B;QACpB;IACJ;IAEA8B,UAAU;QACRlD,KAAKmD,aAAa;IACpB;IAEAC,GAAG,iEAAiE;QAClE,MAAMC,UAAUlB;QAEhBmB,IAAAA,cAAM,gBACJ,qBAACD;sBACC,cAAA,qBAACE,4CAAqB;;QAI1B,mBAAmB;QACnBC,OAAOC,cAAM,CAACC,SAAS,CAAC,uBAAuBC,iBAAiB;QAChEH,OAAOC,cAAM,CAACC,SAAS,CAAC,0CAA0CC,iBAAiB;QAEnF,0BAA0B;QAC1BH,OAAOC,cAAM,CAACC,SAAS,CAAC,mCAAmCC,iBAAiB;IAC9E;IAEAP,GAAG,wCAAwC;QACzC,MAAMC,UAAUlB;QAEhBmB,IAAAA,cAAM,gBACJ,qBAACD;sBACC,cAAA,qBAACE,4CAAqB;;QAI1B,wBAAwB;QACxB,MAAMK,IAAAA,eAAO,EAAC;YACZJ,OAAOC,cAAM,CAACC,SAAS,CAAC,uBAAuBC,iBAAiB;QAClE;QAEA,6BAA6B;QAC7BH,OAAOC,cAAM,CAACC,SAAS,CAAC,0BAA0BC,iBAAiB;QACnEH,OAAOC,cAAM,CAACC,SAAS,CAAC,aAAaC,iBAAiB;QACtDH,OAAOC,cAAM,CAACC,SAAS,CAAC,SAASC,iBAAiB;QAClDH,OAAOC,cAAM,CAACC,SAAS,CAAC,YAAYC,iBAAiB;QAErD,4BAA4B;QAC5BH,OAAOC,cAAM,CAACC,SAAS,CAAC,oBAAoBC,iBAAiB;QAC7DH,OAAOC,cAAM,CAACC,SAAS,CAAC,iBAAiBC,iBAAiB;QAC1DH,OAAOC,cAAM,CAACC,SAAS,CAAC,eAAeC,iBAAiB;QACxDH,OAAOC,cAAM,CAACC,SAAS,CAAC,YAAYC,iBAAiB;IACvD;IAEAP,GAAG,qDAAqD;QACtD,MAAMC,UAAUlB;QAEhB,sBAAsB;QACrBtB,MACEkC,qBAAqB,CAAC;YACrBC,IAAI;YACJC,MAAM,UAAYnC;QACpB,GACCiC,qBAAqB,CAAC;YACrBC,IAAI;YACJC,MAAM,UAAY,EAAE;QACtB;QAEFK,IAAAA,cAAM,gBACJ,qBAACD;sBACC,cAAA,qBAACE,4CAAqB;;QAI1B,MAAMK,IAAAA,eAAO,EAAC;YACZJ,OAAOC,cAAM,CAACC,SAAS,CAAC,2BAA2BC,iBAAiB;YACpEH,OAAOC,cAAM,CAACC,SAAS,CAAC,yCAAyCC,iBAAiB;QACpF;IACF;IAEAP,GAAG,sCAAsC;QACvC,MAAMC,UAAUlB;QAEhB,mBAAmB;QAClBtB,MACEkC,qBAAqB,CAAC;YACrBC,IAAI;YACJC,MAAM,UAAYnC;QACpB,GACC+C,qBAAqB,CAAC,IAAIC,MAAM;QAEnCR,IAAAA,cAAM,gBACJ,qBAACD;sBACC,cAAA,qBAACE,4CAAqB;;QAI1B,MAAMK,IAAAA,eAAO,EAAC;YACZJ,OAAOC,cAAM,CAACC,SAAS,CAAC,gCAAgCC,iBAAiB;QAC3E;IACF;IAEAP,GAAG,4BAA4B;QAC7B,MAAMC,UAAUlB;QAEhBmB,IAAAA,cAAM,gBACJ,qBAACD;sBACC,cAAA,qBAACE,4CAAqB;gBAACQ,WAAU;;;QAIrC,MAAMC,YAAYP,cAAM,CAACC,SAAS,CAAC,sBAAsBO,OAAO,CAAC;QACjET,OAAOQ,WAAWE,WAAW,CAAC;IAChC;AACF;AAEA,4CAA4C;AAC5CtB,SAAS,yBAAyB;IAChC,MAAMuB,cAAgE,CAAC,EACrE5C,MAAM,EACN6C,OAAO,IAAI,EACZ;QACC,MAAMC,eAAe;YACnBC,SAAS;gBAAEC,OAAO;YAAU;YAC5BC,SAAS;gBAAED,OAAO;YAAU;YAC5BE,SAAS;gBAAEF,OAAO;YAAU;YAC5BG,SAAS;gBAAEH,OAAO;YAAS;YAC3BI,WAAW;gBAAEJ,OAAO;YAAY;YAChCK,SAAS;gBAAEL,OAAO;YAAU;QAC9B;QAEA,MAAMM,SAASR,YAAY,CAAC9C,OAAoC,IAAI8C,aAAaC,OAAO;QACxF,MAAMQ,cAAcV,SAAS,OAAO,sBAAsB;QAE1D,qBACE,qBAACW;YAAKhB,WAAW,CAAC,0DAA0D,EAAEe,aAAa;sBACxFD,OAAON,KAAK;;IAGnB;IAEAnB,GAAG,sCAAsC;QACvC,MAAM4B,WAAW;YAAC;YAAW;YAAW;YAAW;YAAW;YAAa;SAAU;QAErFA,SAASC,OAAO,CAAC1D,CAAAA;YACf,MAAM,EAAE2D,OAAO,EAAE,GAAG5B,IAAAA,cAAM,gBAAC,qBAACa;gBAAY5C,QAAQA;;YAChD,MAAM4D,gBAAgB5D,WAAW,YAAY,WACxBA,OAAO6D,MAAM,CAAC,GAAGC,WAAW,KAAK9D,OAAO+D,KAAK,CAAC;YACnE9B,OAAOC,cAAM,CAACC,SAAS,CAACyB,gBAAgBxB,iBAAiB;YACzDuB;QACF;IACF;IAEA9B,GAAG,gCAAgC;QACjC,MAAM,EAAEmC,QAAQ,EAAE,GAAGjC,IAAAA,cAAM,gBAAC,qBAACa;YAAY5C,QAAO;YAAU6C,MAAK;;QAC/DZ,OAAOC,cAAM,CAACC,SAAS,CAAC,YAAYQ,WAAW,CAAC,WAAW,QAAQ;QAEnEqB,uBAAS,qBAACpB;YAAY5C,QAAO;YAAU6C,MAAK;;QAC5CZ,OAAOC,cAAM,CAACC,SAAS,CAAC,YAAYQ,WAAW,CAAC,WAAW,QAAQ;IACrE;AACF"}