{"version":3,"sources":["/Users/pavan/Desktop/Devops-app-dev-cursor/frontend/src/tests/components/dashboard/TeamSwitcher.test.tsx"],"sourcesContent":["import { render, screen, fireEvent, waitFor } from '@testing-library/react';\nimport { ReactNode } from 'react';\nimport TeamSwitcher from '../../../components/dashboard/TeamSwitcher';\nimport { TeamProvider } from '../../../contexts/TeamContext';\nimport { Team } from '../../../types/team';\n\n// Mock the team API\nconst mockGetUserTeams = jest.fn();\nconst mockGetTeamMembers = jest.fn();\njest.mock('../../../services/teamApi', () => ({\n  teamApi: {\n    getUserTeams: mockGetUserTeams,\n    getTeamMembers: mockGetTeamMembers,\n  },\n}));\n\n// Mock localStorage\nconst mockLocalStorage = {\n  getItem: jest.fn(),\n  setItem: jest.fn(),\n  removeItem: jest.fn(),\n};\nObject.defineProperty(window, 'localStorage', {\n  value: mockLocalStorage,\n});\n\nconst mockTeams: Team[] = [\n  {\n    id: 1,\n    name: 'team-alpha',\n    display_name: 'Team Alpha',\n    description: 'Alpha development team',\n    slug: 'team-alpha',\n    settings: {\n      allow_external_invites: true,\n      require_admin_approval: false,\n      default_member_role: 'member' as any,\n      visibility: 'private',\n      notifications: { email: true, slack: false, webhook: false },\n    },\n    permissions: {\n      repository_access: true,\n      deployment_access: true,\n      monitoring_access: true,\n      cost_view_access: true,\n      settings_access: true,\n    },\n    is_active: true,\n    member_count: 5,\n    created_by_user_id: 1,\n    created_at: new Date().toISOString(),\n    updated_at: new Date().toISOString(),\n  },\n  {\n    id: 2,\n    name: 'team-beta',\n    display_name: 'Team Beta',\n    description: 'Beta testing team',\n    slug: 'team-beta',\n    settings: {\n      allow_external_invites: false,\n      require_admin_approval: true,\n      default_member_role: 'viewer' as any,\n      visibility: 'private',\n      notifications: { email: true, slack: true, webhook: false },\n    },\n    permissions: {\n      repository_access: true,\n      deployment_access: false,\n      monitoring_access: true,\n      cost_view_access: false,\n      settings_access: false,\n    },\n    is_active: true,\n    member_count: 3,\n    created_by_user_id: 2,\n    created_at: new Date().toISOString(),\n    updated_at: new Date().toISOString(),\n  },\n];\n\nconst TestWrapper = ({ children }: { children: ReactNode }) => (\n  <TeamProvider>{children}</TeamProvider>\n);\n\ndescribe('TeamSwitcher', () => {\n  const mockOnManageTeams = jest.fn();\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    mockLocalStorage.getItem.mockReturnValue(null);\n    mockGetUserTeams.mockResolvedValue(mockTeams);\n    mockGetTeamMembers.mockResolvedValue([\n      { user_id: 1, role: 'ADMIN' }\n    ]);\n  });\n\n  it('should render the current team when teams are loaded', async () => {\n    render(\n      <TestWrapper>\n        <TeamSwitcher onManageTeams={mockOnManageTeams} />\n      </TestWrapper>\n    );\n\n    // Wait for teams to load\n    await waitFor(() => {\n      expect(screen.getByText('Team Alpha')).toBeInTheDocument();\n    });\n\n    expect(screen.getByText('Admin')).toBeInTheDocument();\n  });\n\n  it('should show loading state when teams are loading', () => {\n    mockGetUserTeams.mockImplementation(() => new Promise(() => {})); // Never resolves\n\n    render(\n      <TestWrapper>\n        <TeamSwitcher onManageTeams={mockOnManageTeams} />\n      </TestWrapper>\n    );\n\n    // Should show loading skeleton\n    expect(document.querySelector('.animate-pulse')).toBeInTheDocument();\n  });\n\n  it('should show single team when only one team exists', async () => {\n    mockGetUserTeams.mockResolvedValue([mockTeams[0]]);\n\n    render(\n      <TestWrapper>\n        <TeamSwitcher onManageTeams={mockOnManageTeams} />\n      </TestWrapper>\n    );\n\n    await waitFor(() => {\n      expect(screen.getByText('Team Alpha')).toBeInTheDocument();\n    });\n\n    // Should only show one team option\n    expect(screen.queryByText('Team Beta')).not.toBeInTheDocument();\n  });\n\n  it('should open dropdown when clicked', async () => {\n    render(\n      <TestWrapper>\n        <TeamSwitcher onManageTeams={mockOnManageTeams} />\n      </TestWrapper>\n    );\n\n    await waitFor(() => {\n      expect(screen.getByText('Team Alpha')).toBeInTheDocument();\n    });\n\n    // Click the team switcher button\n    const button = screen.getByRole('button', { name: /current team/i });\n    fireEvent.click(button);\n\n    // Check if dropdown is open\n    await waitFor(() => {\n      expect(screen.getByText('Team Beta')).toBeInTheDocument();\n    });\n  });\n\n  it('should select a different team when clicked', async () => {\n    mockGetTeamMembers\n      .mockResolvedValueOnce([{ user_id: 1, role: 'ADMIN' }])\n      .mockResolvedValueOnce([{ user_id: 2, role: 'MEMBER' }]);\n\n    render(\n      <TestWrapper>\n        <TeamSwitcher onManageTeams={mockOnManageTeams} />\n      </TestWrapper>\n    );\n\n    await waitFor(() => {\n      expect(screen.getByText('Team Alpha')).toBeInTheDocument();\n    });\n\n    // Open dropdown\n    const button = screen.getByRole('button', { name: /current team/i });\n    fireEvent.click(button);\n\n    // Wait for dropdown to appear\n    await waitFor(() => {\n      expect(screen.getByText('Team Beta')).toBeInTheDocument();\n    });\n\n    // Click on Team Beta\n    const teamBetaOption = screen.getByText('Team Beta').closest('button');\n    if (teamBetaOption) {\n      fireEvent.click(teamBetaOption);\n    }\n\n    // Verify team switched\n    await waitFor(() => {\n      expect(mockLocalStorage.setItem).toHaveBeenCalledWith('opsight_selected_team_id', '2');\n    });\n  });\n\n  it('should handle keyboard navigation', async () => {\n    render(\n      <TestWrapper>\n        <TeamSwitcher onManageTeams={mockOnManageTeams} />\n      </TestWrapper>\n    );\n\n    await waitFor(() => {\n      expect(screen.getByText('Team Alpha')).toBeInTheDocument();\n    });\n\n    const button = screen.getByRole('button', { name: /current team/i });\n    \n    // Test clicking to open dropdown\n    fireEvent.click(button);\n    \n    await waitFor(() => {\n      expect(screen.getByText('Team Beta')).toBeInTheDocument();\n    });\n\n    // Test Escape key to close dropdown\n    fireEvent.keyDown(button, { key: 'Escape', code: 'Escape' });\n    \n    await waitFor(() => {\n      expect(screen.queryByText('Team Beta')).not.toBeInTheDocument();\n    });\n  });\n\n  it('should call onManageTeams when manage teams is clicked', async () => {\n    render(\n      <TestWrapper>\n        <TeamSwitcher onManageTeams={mockOnManageTeams} />\n      </TestWrapper>\n    );\n\n    await waitFor(() => {\n      expect(screen.getByText('Team Alpha')).toBeInTheDocument();\n    });\n\n    // Open dropdown\n    const button = screen.getByRole('button', { name: /current team/i });\n    fireEvent.click(button);\n\n    // Wait for dropdown to appear and look for manage teams option\n    await waitFor(() => {\n      const manageButton = screen.queryByText('Manage Teams');\n      if (manageButton) {\n        fireEvent.click(manageButton);\n        expect(mockOnManageTeams).toHaveBeenCalledTimes(1);\n      }\n    });\n  });\n\n  it('should close dropdown when clicking outside', async () => {\n    render(\n      <div>\n        <TestWrapper>\n          <TeamSwitcher onManageTeams={mockOnManageTeams} />\n        </TestWrapper>\n        <div data-testid=\"outside\">Outside content</div>\n      </div>\n    );\n\n    await waitFor(() => {\n      expect(screen.getByText('Team Alpha')).toBeInTheDocument();\n    });\n\n    // Open dropdown\n    const button = screen.getByRole('button', { name: /current team/i });\n    fireEvent.click(button);\n\n    await waitFor(() => {\n      expect(screen.getByText('Team Beta')).toBeInTheDocument();\n    });\n\n    // Click outside\n    const outsideElement = screen.getByTestId('outside');\n    fireEvent.mouseDown(outsideElement);\n\n    await waitFor(() => {\n      expect(screen.queryByText('Team Beta')).not.toBeInTheDocument();\n    });\n  });\n\n  it('should display team avatars correctly', async () => {\n    render(\n      <TestWrapper>\n        <TeamSwitcher onManageTeams={mockOnManageTeams} />\n      </TestWrapper>\n    );\n\n    await waitFor(() => {\n      expect(screen.getByText('Team Alpha')).toBeInTheDocument();\n    });\n\n    // Check for team initials in avatar\n    expect(screen.getByText('T')).toBeInTheDocument();\n\n    // Open dropdown to see other team avatars\n    const button = screen.getByRole('button', { name: /current team/i });\n    fireEvent.click(button);\n\n    await waitFor(() => {\n      expect(screen.getByText('Team Beta')).toBeInTheDocument();\n    });\n  });\n\n  it('should be accessible via screen readers', async () => {\n    render(\n      <TestWrapper>\n        <TeamSwitcher onManageTeams={mockOnManageTeams} />\n      </TestWrapper>\n    );\n\n    await waitFor(() => {\n      expect(screen.getByText('Team Alpha')).toBeInTheDocument();\n    });\n\n    const button = screen.getByRole('button', { name: /current team/i });\n    \n    // Check ARIA attributes\n    expect(button).toHaveAttribute('aria-expanded', 'false');\n    expect(button).toHaveAttribute('aria-haspopup', 'true');\n\n    // Open dropdown\n    fireEvent.click(button);\n\n    await waitFor(() => {\n      expect(button).toHaveAttribute('aria-expanded', 'true');\n    });\n  });\n}); "],"names":["jest","mock","teamApi","getUserTeams","mockGetUserTeams","getTeamMembers","mockGetTeamMembers","fn","mockLocalStorage","getItem","setItem","removeItem","Object","defineProperty","window","value","mockTeams","id","name","display_name","description","slug","settings","allow_external_invites","require_admin_approval","default_member_role","visibility","notifications","email","slack","webhook","permissions","repository_access","deployment_access","monitoring_access","cost_view_access","settings_access","is_active","member_count","created_by_user_id","created_at","Date","toISOString","updated_at","TestWrapper","children","TeamProvider","describe","mockOnManageTeams","beforeEach","clearAllMocks","mockReturnValue","mockResolvedValue","user_id","role","it","render","TeamSwitcher","onManageTeams","waitFor","expect","screen","getByText","toBeInTheDocument","mockImplementation","Promise","document","querySelector","queryByText","not","button","getByRole","fireEvent","click","mockResolvedValueOnce","teamBetaOption","closest","toHaveBeenCalledWith","keyDown","key","code","manageButton","toHaveBeenCalledTimes","div","data-testid","outsideElement","getByTestId","mouseDown","toHaveAttribute"],"mappings":"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"}