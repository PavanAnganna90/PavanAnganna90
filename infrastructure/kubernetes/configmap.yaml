apiVersion: v1
kind: ConfigMap
metadata:
  name: opssight-backend-config
  namespace: opssight
  labels:
    app: opssight-backend
    component: backend
    environment: production
data:
  # Database configuration
  DATABASE_HOST: "postgres-service.opssight.svc.cluster.local"
  DATABASE_PORT: "5432"
  DATABASE_NAME: "opssight"
  DATABASE_SSL_MODE: "require"
  
  # Redis configuration
  REDIS_HOST: "redis-service.opssight.svc.cluster.local"
  REDIS_PORT: "6379"
  REDIS_SSL: "true"
  
  # Application configuration
  APP_ENV: "production"
  APP_DEBUG: "false"
  APP_LOG_LEVEL: "info"
  APP_PORT: "8000"
  APP_WORKERS: "4"
  
  # Security configuration
  CORS_ALLOWED_ORIGINS: "https://opssight.example.com"
  RATE_LIMIT_ENABLED: "true"
  RATE_LIMIT_REQUESTS: "100"
  RATE_LIMIT_WINDOW: "60"
  
  # Monitoring configuration
  METRICS_ENABLED: "true"
  METRICS_PORT: "9090"
  HEALTH_CHECK_ENABLED: "true"
  HEALTH_CHECK_PATH: "/health"
  
  # AWS configuration
  AWS_REGION: "us-west-2"
  AWS_DEFAULT_REGION: "us-west-2"
  
  # Logging configuration
  LOG_FORMAT: "json"
  LOG_TIMESTAMP: "true"
  LOG_CORRELATION_ID: "true"
  
  # Feature flags
  FEATURE_ANALYTICS: "true"
  FEATURE_ALERTS: "true"
  FEATURE_AUTOMATION: "true"
  FEATURE_COLLABORATION: "true"
  
  # Cache configuration
  CACHE_TTL: "300"
  CACHE_MAX_KEYS: "10000"
  
  # Email configuration
  EMAIL_ENABLED: "true"
  EMAIL_FROM: "noreply@opssight.example.com"
  EMAIL_PROVIDER: "ses"
  
  # Webhook configuration
  WEBHOOK_TIMEOUT: "30"
  WEBHOOK_RETRY_ATTEMPTS: "3"
  WEBHOOK_RETRY_DELAY: "5"
  
  # Kubernetes configuration
  KUBERNETES_NAMESPACE: "opssight"
  KUBERNETES_SERVICE_ACCOUNT: "opssight-backend"
  
  # Prometheus configuration
  PROMETHEUS_METRICS_PATH: "/metrics"
  PROMETHEUS_METRICS_INTERVAL: "15"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: opssight-frontend-config
  namespace: opssight
  labels:
    app: opssight-frontend
    component: frontend
    environment: production
data:
  # Next.js configuration
  NEXT_PUBLIC_API_URL: "https://api.opssight.example.com"
  NEXT_PUBLIC_APP_NAME: "OpsSight"
  NEXT_PUBLIC_APP_VERSION: "1.0.0"
  NEXT_PUBLIC_ENVIRONMENT: "production"
  
  # Feature flags
  NEXT_PUBLIC_FEATURE_ANALYTICS: "true"
  NEXT_PUBLIC_FEATURE_DARK_MODE: "true"
  NEXT_PUBLIC_FEATURE_NOTIFICATIONS: "true"
  NEXT_PUBLIC_FEATURE_COLLABORATION: "true"
  
  # Auth configuration
  NEXT_PUBLIC_AUTH_PROVIDER: "github"
  NEXT_PUBLIC_AUTH_REDIRECT_URL: "https://opssight.example.com/auth/callback"
  
  # Monitoring configuration
  NEXT_PUBLIC_SENTRY_DSN: ""
  NEXT_PUBLIC_ANALYTICS_ID: ""
  
  # API configuration
  NEXT_PUBLIC_API_TIMEOUT: "30000"
  NEXT_PUBLIC_API_RETRY_ATTEMPTS: "3"
  
  # UI configuration
  NEXT_PUBLIC_THEME: "system"
  NEXT_PUBLIC_LANGUAGE: "en"
  NEXT_PUBLIC_TIMEZONE: "UTC"
  
  # Performance configuration
  NEXT_PUBLIC_CACHE_ENABLED: "true"
  NEXT_PUBLIC_LAZY_LOADING: "true"
  NEXT_PUBLIC_IMAGE_OPTIMIZATION: "true"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-config
  namespace: opssight
  labels:
    app: opssight-frontend
    component: nginx
    environment: production
data:
  nginx.conf: |
    events {
        worker_connections 1024;
    }
    
    http {
        include /etc/nginx/mime.types;
        default_type application/octet-stream;
        
        # Logging
        log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                        '$status $body_bytes_sent "$http_referer" '
                        '"$http_user_agent" "$http_x_forwarded_for"';
        
        access_log /var/log/nginx/access.log main;
        error_log /var/log/nginx/error.log warn;
        
        # Performance
        sendfile on;
        tcp_nopush on;
        tcp_nodelay on;
        keepalive_timeout 65;
        types_hash_max_size 2048;
        
        # Security headers
        add_header X-Frame-Options "SAMEORIGIN" always;
        add_header X-Content-Type-Options "nosniff" always;
        add_header X-XSS-Protection "1; mode=block" always;
        add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
        add_header Referrer-Policy "strict-origin-when-cross-origin" always;
        
        # Gzip compression
        gzip on;
        gzip_vary on;
        gzip_proxied any;
        gzip_comp_level 6;
        gzip_types
            text/plain
            text/css
            text/xml
            text/javascript
            application/javascript
            application/xml+rss
            application/json;
        
        # Rate limiting
        limit_req_zone $binary_remote_addr zone=api:10m rate=100r/m;
        limit_req_zone $binary_remote_addr zone=static:10m rate=1000r/m;
        
        upstream backend {
            server opssight-backend-service:8000;
            keepalive 32;
        }
        
        server {
            listen 80;
            server_name localhost;
            root /usr/share/nginx/html;
            index index.html;
            
            # Security
            server_tokens off;
            
            # Static files
            location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
                expires 1y;
                add_header Cache-Control "public, immutable";
                limit_req zone=static burst=50 nodelay;
            }
            
            # API proxy
            location /api/ {
                limit_req zone=api burst=20 nodelay;
                proxy_pass http://backend;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Proto $scheme;
                proxy_connect_timeout 30s;
                proxy_send_timeout 30s;
                proxy_read_timeout 30s;
            }
            
            # Health check
            location /health {
                access_log off;
                return 200 "healthy\n";
                add_header Content-Type text/plain;
            }
            
            # Frontend routes
            location / {
                try_files $uri $uri/ /index.html;
                limit_req zone=static burst=100 nodelay;
            }
        }
    }
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: cluster-autoscaler-config
  namespace: kube-system
  labels:
    app: cluster-autoscaler
data:
  nodes.max: "20"
  nodes.min: "1"
  scale-down-delay-after-add: "10m"
  scale-down-unneeded-time: "10m"
  scale-down-utilization-threshold: "0.5"
  skip-nodes-with-local-storage: "false"
  skip-nodes-with-system-pods: "false"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: fluent-bit-config
  namespace: opssight-monitoring
  labels:
    app: fluent-bit
data:
  fluent-bit.conf: |
    [SERVICE]
        Flush         1
        Log_Level     info
        Daemon        off
        Parsers_File  parsers.conf
        HTTP_Server   On
        HTTP_Listen   0.0.0.0
        HTTP_Port     2020
        Health_Check  On
    
    [INPUT]
        Name              tail
        Path              /var/log/containers/*.log
        Parser            docker
        Tag               kube.*
        Refresh_Interval  5
        Mem_Buf_Limit     50MB
        Skip_Long_Lines   On
    
    [FILTER]
        Name                kubernetes
        Match               kube.*
        Kube_URL            https://kubernetes.default.svc:443
        Kube_CA_File        /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
        Kube_Token_File     /var/run/secrets/kubernetes.io/serviceaccount/token
        Kube_Tag_Prefix     kube.var.log.containers.
        Merge_Log           On
        Keep_Log            Off
        K8S-Logging.Parser  On
        K8S-Logging.Exclude Off
    
    [OUTPUT]
        Name        cloudwatch_logs
        Match       kube.*
        region      us-west-2
        log_group_name /aws/containerinsights/opssight-cluster/application
        log_stream_prefix from-fluent-bit-
        auto_create_group true
  
  parsers.conf: |
    [PARSER]
        Name        docker
        Format      json
        Time_Key    time
        Time_Format %Y-%m-%dT%H:%M:%S.%L
        Time_Keep   On
    
    [PARSER]
        Name        nginx
        Format      regex
        Regex       ^(?<remote>[^ ]*) (?<host>[^ ]*) (?<user>[^ ]*) \[(?<time>[^\]]*)\] "(?<method>\S+)(?: +(?<path>[^\"]*?)(?: +\S*)?)?" (?<code>[^ ]*) (?<size>[^ ]*)(?: "(?<referer>[^\"]*)" "(?<agent>[^\"]*)")?$
        Time_Key    time
        Time_Format %d/%b/%Y:%H:%M:%S %z